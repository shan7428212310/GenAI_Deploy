<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction</title>
    <!-- Add Bootstrap CDN for quick styling -->
     
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        
        .main-container {
        border: 0px solid #007bff;
        padding: 20px;
        background-color: #ffff;        
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        margin: 0 0; /* Adds space on left and right */
        
        max-width: 100%;

    }
       .custom-header {
            font-family: 'Times New Roman', serif;
        }
        .logo {
            width: 100px; /* Adjust as needed */
            height: auto;
            z-index: 1000; /* Ensures it stays on top */
        }

        .right-side-container, .bottom-container {
            border: 2px solid #007bff;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);

        }
        #statusLabel{
            text-align: end;
        }
        .bottom-container {
            text-align: center;
        }
        .params-section {
            display: none;
        }
        .params-section.active {
            display: block;
        }
    </style>
    
</head>
<header class="d-flex justify-content-between align-items-center  text-white position-fixed w-100 px-3" style="top: 0;  background-color: #f7f2f2;height: 60px; z-index: 1000;">
    <h3 class="text-center flex-grow-1 m-0 text-dark">Austin Road Crash Analytics</h3>
    <img src="static/ccslogo1.png" alt="Logo"  class="logo ms-auto" style="height: 40px;">

</header>





<body>
    <div class="container py-4 main-container">
        <!-- Add logo to the top-right corner inside the container -->
    
        <ul class="nav nav-tabs" style="margin-top: 40px;"  id="modelTabs">
            <li class="nav-item">
                <a class="nav-link active" id="severity-tab" data-bs-toggle="tab" href="#severity" aria-controls="severity">Severity Prediction</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="anomaly-tab" data-bs-toggle="tab" href="#anomaly_prediction" aria-controls="anomaly_prediction">Anomaly Prediction</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="temporal-pattern-tab" data-bs-toggle="tab" href="#temporal-pattern" aria-controls="temporal-pattern">Temporal Pattern Prediction</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="risk-prediction-tab" data-bs-toggle="tab" href="#risk-prediction" aria-controls="risk-prediction">Risk Prediction</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="frequency-prediction-tab" data-bs-toggle="tab" href="#frequency-prediction" aria-controls="frequency-prediction">Frequency Prediction</a>
            </li>
        </ul>
    
        <div class="row mt-1">
            <div class="col-lg-3">
                <div class="params-section active p-3 border rounded">
                    <form id="severityForm">
                        <div class="mb-3">
                            <label for="temp_surface_s" class="form-label">Temperature of the Surface</label>
                            <!-- <input type="number" step="any" class="form-control" id="temp_surface_s" placeholder="Ex: 32.5" required> -->
                            <div class="d-flex align-items-center">
                                <input type="range" class="form-range me-2" id="temp_surface_s" min="-100" max="100" step="0.1" value="32.5" oninput="airTempsurface.value = this.value" style="width: 100%;">
                                <input type="text" class="form-control" id="airTempsurface" min="-100" max="100" step="0.1" value="32.5" oninput="temp_surface_s.value = this.value" style="width: 25%;">
                            </div>  
                        </div>
                        <div class="mb-3">
                            <label for="air_temp_secondary_s" class="form-label">Secondary Air Temperature</label>
                            <div class="d-flex align-items-center">
                                <input type="range" class="form-range me-2" id="air_temp_secondary_s" min="-100" max="100" step="0.1" value="22.5" oninput="airTempNumber.value = this.value" style="width: 100%;">
                                <input type="text" class="form-control" id="airTempNumber" min="-100" max="100" step="0.1" value="22.5" oninput="air_temp_secondary_s.value = this.value" style="width: 25%;">
                            </div>                          
                         </div>
                        <div class="mb-3">
                            <label for="grip_text_s" class="form-label">Grip Text</label>
                            <select class="form-control" id="grip_text_s" required>
                                <option value="" disabled selected>Select an option</option>
                                <option value="FAIR">FAIR</option>
                                <option value="GOOD">GOOD</option>
                                <option value="POOR">POOR</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="timestamp_s" class="form-label">Timestamp</label>
                            <input type="datetime-local" class="form-control" id="timestamp_s" required>
                        </div>
                        <div class="mb-3">
                            <label for="loc_crash_s"  class="form-label">Location</label>
                            <input type="text"  step="any" class="form-control" id="loc_crash_s" placeholder="301 West 2nd, Austin, TX 78701" required>
                        </div>
                        <div class="mb-3">
                            <label for="latitude_crash_s" hidden class="form-label">Latitude</label>
                            <input type="number" hidden  step="any" class="form-control" id="latitude_crash_s" placeholder="(Ex: 34.5)" required>
                        </div>
                        <div class="mb-3">
                            <label for="longitude_crash_s" hidden class="form-label">Longitude</label>
                            <input type="number" hidden step="any" class="form-control" id="longitude_crash_s" placeholder="(Ex: -100.25)" required>
                        </div>
                        
                        
                        
                        <div class="mb-3">
                            <label for="crash_speed_limit_s" class="form-label">Speed Limit</label>
                            <input type="number" step="any" class="form-control" id="crash_speed_limit_s" placeholder="Ex: 45" required>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="predictSeverity1()">Predict Severity Level</button>
                    </form>
                </div>
                <div id="frequency-prediction" class="params-section p-3 border rounded">
                    <form id="frequencyPredictionForm">
                        <!-- Crash speed limit input -->
                        <div class="mb-3">
                            <label for="crash_speed_limit" class="form-label">Speed Limit</label>
                            <input type="number" step="any" class="form-control" id="crash_speed_limit" placeholder="Ex: 45">
                        </div>
                
                        <!-- Road construction zone (True/False) input -->
                        <div class="mb-3">
                            <label for="road_constr_zone_fl" class="form-label">Road Construction Zone</label>
                            <select class="form-control" id="road_constr_zone_fl">
                                <option value="" disabled selected>Select an option</option>
                                <option value="True">True</option>
                                <option value="False">False</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="loc_crash"  class="form-label">Location</label>
                            <input type="text"  step="any" class="form-control" id="loc_crash" placeholder="301 West 2nd, Austin, TX 78701" required>
                        </div>
                        <!-- Latitude input -->
                        <div class="mb-3">
                            <label for="latitude" hidden class="form-label">Latitude</label>
                            <input type="number" hidden step="any" class="form-control" id="latitude" placeholder="(Ex: 20.5)">
                        </div>
                
                        <!-- Longitude input -->
                        <div class="mb-3">
                            <label for="longitude" hidden class="form-label">Longitude</label>
                            <input type="number" step="any" hidden class="form-control" id="longitude" placeholder="(Ex: -95.25687)">
                        </div>
                
                        <!-- Units involved input -->
                        <div class="mb-3">
                            <label for="units_involved" class="form-label">Units Involved</label>
                            <input type="number" class="form-control" id="units_involved" placeholder="Ex: 9">
                        </div>
                
                        <!-- Death count input -->
                        <div class="mb-3">
                            <label for="death_cnt" class="form-label">Death</label>
                            <input type="number" class="form-control" id="death_cnt" placeholder="Ex: 4">
                        </div>
                
                        <!-- Non-incapacitating injury count input -->
                        <div class="mb-3">
                            <label for="nonincap_injry_cnt" class="form-label">Non-Incapacitating Injury</label>
                            <input type="number" class="form-control" id="nonincap_injry_cnt" placeholder="Ex: 2">
                        </div>
                
                        <!-- Predict Button -->
                        <button type="button" class="btn btn-primary" onclick="predictfrequency1()">Predict Frequency Level</button>
                    </form>
                </div>
                <div id="temporal-pattern" class="params-section p-3 border rounded">
                    <form id="responseLevelPredictionForm">
                
                        <!-- Date and Time input -->
                        <div class="mb-3">
                            <label for="datetime_t" class="form-label">Date and Time</label>
                            <input type="datetime-local" class="form-control" id="datetime_t" placeholder="Select date and time">
                        </div>
                
                        <!-- Crash speed limit input -->
                        <div class="mb-3">
                            <label for="crash_speed_limit_t" class="form-label">Speed Limit</label>
                            <input type="number" step="1" class="form-control" id="crash_speed_limit_t" placeholder="Ex: 45">
                        </div>
                
                        <!-- Road construction zone (0 or 1) input -->
                        <div class="mb-3">
                            <label for="road_constr_zone_fl" class="form-label">Road Construction Zone</label>
                            <select class="form-control" id="road_constr_zone_fl_t">
                                <option value="" disabled selected>Select an option</option>
                                <option value="1">True</option>
                                <option value="0">False</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="loc_crash_t"  class="form-label">Location</label>
                            <input type="text"  step="any" class="form-control" id="loc_crash_t" placeholder="301 West 2nd, Austin, TX 78701" required>
                        </div>
                        <!-- Latitude input -->
                        <div class="mb-3">
                            <label for="latitude_t" hidden class="form-label">Latitude</label>
                            <input type="number" hidden step="any" class="form-control" id="latitude_t" placeholder="Ex: 20.5">
                        </div>
                
                        <!-- Longitude input -->
                        <div class="mb-3">
                            <label for="longitude_t" hidden class="form-label">Longitude</label>
                            <input type="number" step="any" hidden class="form-control" id="longitude_t" placeholder="(Ex: -95.25687)">
                        </div>
                
                        <!-- Predict Button -->
                        <div class="d-grid">
                            <button type="button" class="btn btn-primary" onclick="predicttemporallevel1()">Predict Temporal Level</button>
                        </div>
                    </form>
                </div>
                
                <div id="risk-prediction" class="params-section p-3 border rounded">
                    <form id="reslevelPredictionForm">
                        <!-- Crash speed limit input -->
                        <div class="mb-3">
                            <label for="crash_speed_limit1" class="form-label">Speed Limit</label>
                            <input type="number" step="any" class="form-control" id="crash_speed_limit1" placeholder="Ex: 45">
                        </div>
                
                        <!-- Road construction zone (True/False) input -->
                        <div class="mb-3">
                            <label for="road_constr_zone_fl1" class="form-label">Road Construction Zone</label>
                            <select class="form-control" id="road_constr_zone_fl1">
                                <option value="" disabled selected>Select an option</option>
                                <option value="True">True</option>
                                <option value="False">False</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="loc_crash1"  class="form-label">Location</label>
                            <input type="text"  step="any" class="form-control" id="loc_crash1" placeholder="301 West 2nd, Austin, TX 78701" required>
                        </div>
                        <!-- Latitude input -->
                        <div class="mb-3">
                            <label for="latitude1" hidden class="form-label">Latitude</label>
                            <input type="number" hidden step="any" class="form-control" id="latitude1" placeholder="Ex: 20.5">
                        </div>
                
                        <!-- Longitude input -->
                        <div class="mb-3">
                            <label for="longitude1"hidden class="form-label">Longitude</label>
                            <input type="number" hidden step="any" class="form-control" id="longitude1" placeholder="(Ex: -95.25687)">
                        </div>
                
                        <!-- Motor vehicle serious injury count input -->
                        <div class="mb-3">
                            <label for="motor_vehicle_serious_injury_count1" class="form-label">Motor Vehicle Serious Injury</label>
                            <input type="number" class="form-control" id="motor_vehicle_serious_injury_count1" placeholder="Ex: 3">
                        </div>
                
                        <!-- Non-incapacitating injury count input -->
                        <div class="mb-3">
                            <label for="nonincap_injry_cnt1" class="form-label">Non-Incapacitating Injury</label>
                            <input type="number" class="form-control" id="nonincap_injry_cnt1" placeholder="Ex: 2">
                        </div>
                
                        <!-- Predict Button -->
                        <button type="button" class="btn btn-primary" onclick="predictResLevel1()">Predict Risk Level</button>
                    </form>
                </div>
                <div id="anomaly_prediction" class="params-section p-3 border rounded">
                    <form id="anomalyPredictionForm">
                         
                        <!-- Voltage X -->
                        <div class="mb-3">
                            <label for="voltage_x" class="form-label">Voltage X</label>
                            <input type="number" step="any" class="form-control" id="voltage_x" placeholder="Ex: 1123">
                        </div>             
                        <!-- Voltage Y -->
                        <div class="mb-3">
                            <label for="voltage_y" class="form-label">Voltage Y</label>
                            <input type="number" step="any" class="form-control" id="voltage_y" placeholder="Ex: 201">
                        </div>
                
                
                        <div class="mb-3">
                            <label for="voltage_ratio" class="form-label">Voltage Ratio</label>
                            <input type="number" step="any" class="form-control" id="voltage_ratio" placeholder="Ex: 5.169" readonly>
                        </div>
                        
                        <script>
                            function calculateVoltageRatio() {
                                let voltageX = parseFloat(document.getElementById('voltage_x').value);
                                let voltageY = parseFloat(document.getElementById('voltage_y').value);
                                let ratioField = document.getElementById('voltage_ratio');
                        
                                if (!isNaN(voltageX) && !isNaN(voltageY) && voltageY !== 0) {
                                    ratioField.value = (voltageX / voltageY);
                                } else {
                                    ratioField.value = '';
                                }
                            }
                        
                            document.getElementById('voltage_x').addEventListener('input', calculateVoltageRatio);
                            document.getElementById('voltage_y').addEventListener('input', calculateVoltageRatio);
                        </script>
                
                        <!-- Air Temperature Secondary -->
                        <div class="mb-3">
                            <label for="air_temp_secondary_a" class="form-label">Air Temperature Secondary</label>
                            <div class="d-flex align-items-center">
                                <input type="range" class="form-range me-2" id="air_temp_secondary_a" min="-100" max="100" step="0.1" value="24.5" oninput="airTempsurface_a.value = this.value" style="width: 100%;">
                                <input type="text" class="form-control" id="airTempsurface_a" min="-100" max="100" step="0.1" value="24.5" oninput="air_temp_secondary_a.value = this.value" style="width: 25%;">
                            </div>  
                            <!-- <input type="number" step="any" class="form-control" id="air_temp_secondary_a" placeholder="Ex: -8.71"> -->
                        </div>
                
                        <!-- Temperature Surface -->
                        <div class="mb-3">
                            <label for="temp_surface_a" class="form-label">Temperature Surface</label>
                            <div class="d-flex align-items-center">
                                <input type="range" class="form-range me-2" id="temp_surface_a" min="-100" max="100" step="0.1" value="30.5" oninput="Tempsurface_a.value = this.value" style="width: 100%;">
                                <input type="text" class="form-control" id="Tempsurface_a" min="-100" max="100" step="0.1" value="30.5" oninput="temp_surface_a.value = this.value" style="width: 25%;">
                            </div>  
                            <!-- <input type="number" step="any" class="form-control" id="temp_surface_a" placeholder="Ex: -8.05"> -->
                        </div>
                
                        <!-- Status Code -->
                        <div class="mb-3">
                            <label for="status_code" class="form-label">Status Code</label>
                            <input type="number" class="form-control" id="status_code" placeholder="Ex: -102">
                        </div>
                
                        <!-- Condition Code Displayed -->
                        <div class="mb-3">
                            <label for="condition_code_displayed" class="form-label">Condition Code Displayed</label>
                            <input type="number" class="form-control" id="condition_code_displayed_a" placeholder="Ex: 5">
                        </div>
                
                        <!-- Condition Code Measured -->
                        <div class="mb-3">
                            <label for="condition_code_measured" class="form-label">Condition Code Measured</label>
                            <input type="number" class="form-control" id="condition_code_measured_a" placeholder="Ex: 5">
                        </div>
                
                        <!-- Friction Code Displayed -->
                        <div class="mb-3">
                            <label for="friction_code_displayed" class="form-label">Friction Code Displayed</label>
                            <input type="number" class="form-control" id="friction_code_displayed_a" placeholder="Ex: 20">
                        </div>
                
                        <!-- Grip Text Selection -->
                        <div class="mb-3">
                            <label for="grip_text" class="form-label">Grip Text</label>
                            <select class="form-control" id="grip_text_a" required>
                                <option value="" disabled selected>Select an option</option>
                                <option value="FAIR">FAIR</option>
                                <option value="GOOD">GOOD</option>
                                <option value="POOR">POOR</option>
                            </select>
                        </div>
                
                        <!-- Predict Button -->
                        <button type="button" class="btn btn-primary" onclick="predictanomaly()">Predict Anomaly Level</button>
                    </form>
                </div>
            </div>
    
            <div class="col-lg-9">
                <div class="right-side-container p-3 border rounded mb-4">
                    <iframe id="dashIframe" src="/dash/" class="w-100" style="height: 400px; border: none;"></iframe>
                </div>
                <div class="bottom-container border rounded p-3 text-center">
                    <p id="statusLabel" class="fw-bold text-primary">Status: Ready</p>
                    <p id="predictionResult" class="custom-header">Prediction will be displayed here.</p>
                    <div id="frequencyhighlight"></div>
                    <div id="severityHighlight" class="fw-bold" style="font-size: 16px;"></div>
                </div>
            </div>
        </div>
    </div>
    
        
       
    
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        function searchLocation(callback) {
            let location_sev = document.getElementById("loc_crash_s").value.trim();
            let location_fre = document.getElementById("loc_crash").value.trim();
            let location_res = document.getElementById("loc_crash1").value.trim();
            let location_temp = document.getElementById("loc_crash_t").value.trim();

            let requests = [];

            // Fetch coordinates if location_sev is provided
            if (location_sev !== "") {
                let url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location_sev)}`;
                requests.push(
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            if (data.length > 0) {
                                document.getElementById("latitude_crash_s").value = data[0].lat;
                                document.getElementById("longitude_crash_s").value = data[0].lon;
                            } else {
                                alert(`Location "${location_sev}" not found. Try a different search.`);
                            }
                        })
                        .catch(error => {
                            console.error("Error fetching location:", error);
                            alert(`Failed to fetch location for "${location_sev}". Try again.`);
                        })
                );
            }

            // Fetch coordinates if location_fre is provided
            if (location_fre !== "") {
                let url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location_fre)}`;
                requests.push(
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            if (data.length > 0) {
                                document.getElementById("latitude").value = data[0].lat;
                                document.getElementById("longitude").value = data[0].lon;
                            } else {
                                alert(`Location "${location_fre}" not found. Try a different search.`);
                            }
                        })
                        .catch(error => {
                            console.error("Error fetching location:", error);
                            alert(`Failed to fetch location for "${location_fre}". Try again.`);
                        })
                );
            }
            if (location_res !== "") {
                let url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location_res)}`;
                requests.push(
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            if (data.length > 0) {
                                document.getElementById("latitude1").value = data[0].lat;
                                document.getElementById("longitude1").value = data[0].lon;
                            } else {
                                alert(`Location "${location_fre}" not found. Try a different search.`);
                            }
                        })
                        .catch(error => {
                            console.error("Error fetching location:", error);
                            alert(`Failed to fetch location for "${location_fre}". Try again.`);
                        })
                );
            }
            if (location_temp !== "") {
                let url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location_temp)}`;
                requests.push(
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            if (data.length > 0) {
                                document.getElementById("latitude_t").value = data[0].lat;
                                document.getElementById("longitude_t").value = data[0].lon;
                            } else {
                                alert(`Location "${location_fre}" not found. Try a different search.`);
                            }
                        })
                        .catch(error => {
                            console.error("Error fetching location:", error);
                            alert(`Failed to fetch location for "${location_fre}". Try again.`);
                        })
                );
            }
            // Run the callback function after all fetch requests complete
            Promise.all(requests).then(() => {
                if (callback) callback();
            });
        }

        function predictSeverity1() {
            searchLocation(predictSeverity);
        }
        function predictfrequency1() {
            searchLocation(predictfrequency);
        }
        function predictResLevel1() {
            searchLocation(predictResLevel);
        }
        function predicttemporallevel1() {
            searchLocation(predicttemporallevel);
        }
        function predictSeverity() {
            // Get the values from the form inputs
            const temp_surface = document.getElementById('temp_surface_s').value;
            const air_temp_secondary = document.getElementById('air_temp_secondary_s').value;
            const grip_text = document.getElementById('grip_text_s').value;
            const timestamp = document.getElementById('timestamp_s').value;
            const latitude_crash = document.getElementById('latitude_crash_s').value;
            const longitude_crash = document.getElementById('longitude_crash_s').value;
            const crash_speed_limit = document.getElementById('crash_speed_limit_s').value;
            const crash_loc = document.getElementById('loc_crash_s').value;

            

            // Check if any required fields are empty
            if (!temp_surface || !air_temp_secondary || !grip_text || !timestamp || !latitude_crash || !longitude_crash || !crash_speed_limit||!crash_loc) {
                // Display a message asking the user to fill in all fields
                alert("Please fill in all fields.");
                return;  // Stop further execution
            }
            const statusLabel = document.getElementById('statusLabel');
            statusLabel.textContent = "Loading...";  // You can also use "Calculating..." or any other status message

            // Create the user input object
            const userInput = {
                temp_surface: parseFloat(temp_surface),
                air_temp_secondary: parseFloat(air_temp_secondary),
                grip_text: grip_text,
                timestamp: timestamp,
                latitude_crash: parseFloat(latitude_crash),
                longitude_crash: parseFloat(longitude_crash),
                crash_speed_limit: parseFloat(crash_speed_limit)
            };

            // Send a POST request to the server with the user input
            fetch('/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userInput)
            })
            .then(response => response.json())
            .then(data => {
                statusLabel.textContent = "Generating..."; // You can change this text to whatever fits

                document.getElementById('predictionResult').textContent = `Predicted Severity: ${data.severity_description}`;

            // Set the color of severity highlight based on the severity
            const severityHighlight = document.getElementById('severityHighlight');
            severityHighlight.style.fontFamily = 'Times New Roman, serif';

            switch (data.severity_description) {
                case 'KILLED' || 'INCAPACITATING INJURY':
                    severityHighlight.style.color = 'red';
                    break;
                case 'POSSIBLE INJURY':
                    severityHighlight.style.color = 'orange';
                    break;
                case 'NON-INCAPACITATING INJURY':
                    severityHighlight.style.color = 'yellow';
                    break;
                case 'NOT INJURED':
                    severityHighlight.style.color = 'green';
                    break;
                default:
                    severityHighlight.style.color = 'black';  // Default color for undefined severity
                    break;
            }

            // Display the severity highlight HTML
            severityHighlight.innerHTML = data.severity_highlight;
            statusLabel.textContent = "Completed"; // Or "Done" if you'd like

        })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        
        function predictfrequency() {
            //searchLocation()

            // Get the values from the form inputs
            const crash_speed_limit = document.getElementById('crash_speed_limit').value;
            const road_constr_zone_fl = document.getElementById('road_constr_zone_fl').value;
            const latitude = document.getElementById('latitude').value;
            const longitude = document.getElementById('longitude').value;
            const units_involved = document.getElementById('units_involved').value;
            const death_cnt = document.getElementById('death_cnt').value;
            const nonincap_injry_cnt = document.getElementById('nonincap_injry_cnt').value;
            const crash_loc_f = document.getElementById('loc_crash').value;
            
            // Check if any required fields are empty
            if (!crash_speed_limit || !road_constr_zone_fl || !latitude || !longitude || !units_involved || !death_cnt || !nonincap_injry_cnt||!crash_loc_f) {
                alert("Please fill in all fields.");
                return;  // Stop further execution
            }
            const statusLabel = document.getElementById('statusLabel');
            statusLabel.textContent = "Loading...";  // You can also use "Calculating..." or any other status message

            // Create the user input object
            const userInput = {
                crash_speed_limit: parseFloat(crash_speed_limit),
                road_constr_zone_fl: road_constr_zone_fl.trim().toLowerCase() === 'true', // Convert input to boolean
                latitude: parseFloat(latitude),
                longitude: parseFloat(longitude),
                units_involved: parseInt(units_involved),
                death_cnt: parseInt(death_cnt),
                nonincap_injry_cnt: parseInt(nonincap_injry_cnt)
            };

            // Send a POST request to the server with the user input
            fetch('/predict_frequency', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userInput)
            })
            .then(response => response.json())
            // JavaScript code to handle frequency prediction response
            .then(data => {
                statusLabel.textContent = "Generating..."; // You can change this text to whatever fits

                document.getElementById('predictionResult').textContent = `Predicted Frequency: ${data.predicted_frequency_per_day} crashes per day`;
                document.getElementById('frequencyhighlight').innerHTML = `Predicted Frequency: ${data.predicted_frequency_per_hour} crashes per hour`;
                statusLabel.textContent = "Completed"; // Or "Done" if you'd like
                
            })

            .catch(error => {
                console.error('Error:', error);
            });
        }

        
        function predictResLevel() {
            // Get the values from the form inputs
            const crash_speed_limit1 = document.getElementById('crash_speed_limit1').value;
            const road_constr_zone_fl1 = document.getElementById('road_constr_zone_fl1').value;
            const latitude1 = document.getElementById('latitude1').value;
            const longitude1 = document.getElementById('longitude1').value;
            const motor_vehicle_serious_injury_count1 = document.getElementById('motor_vehicle_serious_injury_count1').value;
            const nonincap_injry_cnt1 = document.getElementById('nonincap_injry_cnt1').value;
            const crash_loc1 = document.getElementById('loc_crash1').value;

            // Check if any required fields are empty
            if (!crash_speed_limit1 || !road_constr_zone_fl1 || !latitude1 || !longitude1 || !motor_vehicle_serious_injury_count1 || !nonincap_injry_cnt1||!crash_loc1) {
                alert("Please fill in all fields.");
                return;  // Stop further execution
            }
            const statusLabel = document.getElementById('statusLabel');
            statusLabel.textContent = "Loading...";  // You can also use "Calculating..." or any other status message

            // Create the user input object
            const userInput = {
                crash_speed_limit: parseFloat(crash_speed_limit1),
                road_constr_zone_fl: road_constr_zone_fl1.trim().toLowerCase() === 'true', // Convert input to boolean
                latitude: parseFloat(latitude1),
                longitude: parseFloat(longitude1),
                motor_vehicle_serious_injury_count: parseInt(motor_vehicle_serious_injury_count1),
                nonincap_injry_cnt: parseInt(nonincap_injry_cnt1)
            };

            // Send a POST request to the server with the user input
            fetch('/predict_res_level', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userInput)
            })
            .then(response => response.json())
            .then(data => {
                statusLabel.textContent = "Generating..."; // You can change this text to whatever fits

                document.getElementById('predictionResult').textContent = `Predicted Risk Level: ${data.predicted_risk_level}`;
                const severityHighlight = document.getElementById('severityHighlight');
                severityHighlight.style.fontFamily = 'Times New Roman, serif';

                switch (data.predicted_risk_level) {
                    case 'High' :
                        severityHighlight.style.color = 'red';
                        break;
                    case 'Moderate' :
                        severityHighlight.style.color = 'orange';
                        break;
                    case 'Low' :
                        severityHighlight.style.color = 'green';
                        break;
                    
                    default:
                        severityHighlight.style.color = 'black';  // Default color for undefined severity
                        break;
                }

            // Display the severity highlight HTML
            severityHighlight.innerHTML = data.severity_message;
            statusLabel.textContent = "Completed"; // Or "Done" if you'd like
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        
        function predicttemporallevel() {
            // Get the values from the form inputs
            const crash_speed_limit = document.getElementById('crash_speed_limit_t').value;
            const road_constr_zone_fl = document.getElementById('road_constr_zone_fl_t').value;
            const latitude = document.getElementById('latitude_t').value;
            const longitude = document.getElementById('longitude_t').value;
            const datetime = document.getElementById('datetime_t').value;
            const crash_loc_t = document.getElementById('loc_crash_t').value;

            // Check if any required fields are empty
            if (!crash_speed_limit || !road_constr_zone_fl || !latitude || !longitude || !datetime||!crash_loc_t) {
                alert("Please fill in all fields.");
                return;  // Stop further execution
            }
              // Update the label to show "Loading..." or "Calculating..."
            const statusLabel = document.getElementById('statusLabel');
            statusLabel.textContent = "Loading...";  // You can also use "Calculating..." or any other status message

            // Create   the user input object
            const userInput = {
                ds: new Date(datetime), // Convert input to datetime
                latitude: parseFloat(latitude),
                longitude: parseFloat(longitude),
                road_constr_zone_fl: parseInt(road_constr_zone_fl), // Convert input to integer
                crash_speed_limit: parseInt(crash_speed_limit)
            };

            // Send a POST request to the server with the user input
            fetch('/predict_temporal_level', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userInput)
            })
            .then(response => response.json())
            .then(data => {
                statusLabel.textContent = "Generating..."; // You can change this text to whatever fits

                document.getElementById('predictionResult').textContent = `Predicted Temporal Level: ${data.predicted_risk_level}`;
                //document.getElementById('severityHighlight').textContent = `${data.severity_message}`;

                const severityHighlight = document.getElementById('severityHighlight');
                severityHighlight.style.fontFamily = 'Times New Roman, serif';

                switch (data.predicted_risk_level) {
                    case 'High Risk' :
                        severityHighlight.style.color = 'red';
                        break;
                    case 'Moderate' :
                        severityHighlight.style.color = 'orange';
                        break;
                    case 'Low' :
                        severityHighlight.style.color = 'green';
                        break;
                    
                    default:
                        severityHighlight.style.color = 'black';  // Default color for undefined severity
                        break;
                }

            // Display the severity highlight HTML
            severityHighlight.innerHTML = data.severity_message;
            statusLabel.textContent = "Completed"; // Or "Done" if you'd like
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

       

        function predictanomaly() {
            // Get the values from the form inputs
            const voltage_y = document.getElementById('voltage_y').value;
            const voltage_x = document.getElementById('voltage_x').value;
            const voltage_ratio = document.getElementById('voltage_ratio').value;
            const air_temp_secondary = document.getElementById('air_temp_secondary_a').value;
            const temp_surface = document.getElementById('temp_surface_a').value;
            const status_code = document.getElementById('status_code').value;
            const condition_code_displayed = document.getElementById('condition_code_displayed_a').value;
            const condition_code_measured = document.getElementById('condition_code_measured_a').value;
            const friction_code_displayed = document.getElementById('friction_code_displayed_a').value;
            const grip_text = document.getElementById('grip_text_a').value;

            // Check if any required fields are empty
            if (!voltage_y || !voltage_x || !voltage_ratio || !air_temp_secondary || !temp_surface || !status_code ||
                !condition_code_displayed || !condition_code_measured || !friction_code_displayed || !grip_text) {
                alert("Please fill in all fields.");
                return;  // Stop further execution
            }
            
            // Update the label to show "Loading..." or "Calculating..."
            const statusLabel = document.getElementById('statusLabel');
            statusLabel.textContent = "Loading...";  // You can also use "Calculating..." or any other status message

            // Create the user input object
            const userInput = {
                voltage_y: parseFloat(voltage_y), // Convert input to float
                voltage_x: parseFloat(voltage_x), // Convert input to float
                voltage_ratio: parseFloat(voltage_ratio), // Convert input to float
                air_temp_secondary: parseFloat(air_temp_secondary), // Convert input to float
                temp_surface: parseFloat(temp_surface), // Convert input to float
                status_code: parseInt(status_code), // Convert input to integer
                condition_code_displayed: parseInt(condition_code_displayed), // Convert input to integer
                condition_code_measured: parseInt(condition_code_measured), // Convert input to integer
                friction_code_displayed: parseInt(friction_code_displayed), // Convert input to integer
                grip_text: grip_text // String input
            };

            // Send a POST request to the server with the user input
            fetch('/predict_anomaly_level', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userInput)
            })
            .then(response => response.json())
            .then(data => {
                statusLabel.textContent = "Generating..."; // You can change this text to whatever fits

                document.getElementById('predictionResult').textContent = `Predicted Level: ${data.anomaly_result}`;

                const severityHighlight = document.getElementById('severityHighlight');
                severityHighlight.style.fontFamily = 'Times New Roman, serif';

                switch (data.anomaly_result) {
                    case 'Anomaly' :
                        severityHighlight.style.color = 'red';
                        break;
                    
                    default:
                        severityHighlight.style.color = 'black';  // Default color for undefined severity
                        break;
                }

            // Display the severity highlight HTML
            severityHighlight.innerHTML = data.severity_message;
            statusLabel.textContent = "Completed"; // Or "Done" if you'd like
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        // JavaScript to show and hide parameter sections based on the active tab
        $('#modelTabs a').on('click', function (e) {
            var targetTab = $(this).attr('href').substring(1); // Get the target tab
            $('.params-section').removeClass('active'); // Hide all parameter sections
            $('#' + targetTab + '-params').addClass('active'); // Show the relevant parameter section
        });

        // Trigger the parameter section display when the page loads
        $(document).ready(function () {
            var activeTab = $('.nav-link.active').attr('href').substring(1);
            $('#' + activeTab + '-params').addClass('active'); // Show parameters for the active tab
        });
        $('#modelTabs a').on('shown.bs.tab', function (e) {
            // Clear the prediction result and severity highlight when tab changes
            $('#predictionResult').text('Prediction will be displayed here.');
            $('#severityHighlight').text('');
            $('#frequencyhighlight').text('');
            const statusLabel = document.getElementById('statusLabel');
            statusLabel.textContent = "Ready";  // You can also use "Calculating..." or any other status message


        });
        // Listen for tab changes and update iframe src accordingly
        $('#modelTabs a').on('click', function (e) {
            e.preventDefault();
            
            var targetTab = $(this).attr('href').substring(1); // Get the target tab ID
            var iframe = document.getElementById('dashIframe');
            
               switch (targetTab) {
                case 'severity':
                    iframe.src = "/dash/";
                    break;
                case 'frequency-prediction':
                    iframe.src = "/dash/other/";
                    break;
                case 'risk-prediction':
                    iframe.src = "/crash_analysis/";
                    break;
                case 'temporal-pattern':
                    iframe.src = "/temporal_analysis/";
                    break;
                case 'anomaly_prediction':
                    iframe.src = "/anomaly_analysis/";
                    break;
            }
            
            $('.params-section').removeClass('active'); // Hide all forms
            $('#' + targetTab + 'Form').closest('.params-section').addClass('active'); // Show relevant form
            
            $(this).tab('show'); // Activate the clicked tab       
            });
           
    </script>
</body>
</html>
